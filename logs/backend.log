INFO:     Will watch for changes in these directories: ['/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [45394] using WatchFiles
INFO:     Started server process [45397]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.222 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'diagnose.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45397]
INFO:     Started server process [45461]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.220 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/data/simple_vectorizer.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45461]
INFO:     Started server process [45493]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.223 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/data/vectorizer.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45493]
INFO:     Started server process [45496]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.224 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/data/vectorizer.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45496]
INFO:     Started server process [45498]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.219 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/simple_retriever.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45498]
INFO:     Started server process [45592]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.222 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/retriever.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45592]
INFO:     Started server process [45615]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.226 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
Starting SupplyChainRAG API...
Database tables created at sqlite:///data/supply_chain.db

Loading indices from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices...
HNSW index loaded: 190 vectors from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices/hnsw.faiss
All indices loaded successfully!

RAG indices loaded
INFO:     127.0.0.1:56607 - "GET /ui?mode=round&rounds=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:56607 - "GET /health HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'src/rag/hnsw_pure.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [45615]
INFO:     Started server process [46014]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.219 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/ivf_pq_pure.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46014]
INFO:     Started server process [46029]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.220 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/retriever.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46029]
Process SpawnProcess-10:
Traceback (most recent call last):
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 67, in run
    return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/_compat.py", line 30, in asyncio_run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/config.py", line 439, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1126, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1147, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/__init__.py", line 3, in <module>
    from src.ui.backend import app
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend.py", line 19, in <module>
    from src.agent.orchestrator import AgentOrchestrator, RoundModeOrchestrator, get_orchestrator
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 24, in <module>
    from src.rag.retriever import UnifiedRetriever
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/rag/retriever.py", line 25, in <module>
    from src.rag.hnsw_pure import PureHNSWRetriever
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/rag/hnsw_pure.py", line 81
    def _ cosine_similarity(self, a: np.ndarray, b: np.ndarray) -> float:
          ^^^^^^^^^^^^^^^^^
SyntaxError: expected '('
WARNING:  WatchFiles detected changes in 'scripts/build_indexes.py'. Reloading...
Process SpawnProcess-11:
Traceback (most recent call last):
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 67, in run
    return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/_compat.py", line 30, in asyncio_run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/config.py", line 439, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1126, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1204, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1176, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1147, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/__init__.py", line 3, in <module>
    from src.ui.backend import app
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend.py", line 19, in <module>
    from src.agent.orchestrator import AgentOrchestrator, RoundModeOrchestrator, get_orchestrator
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 24, in <module>
    from src.rag.retriever import UnifiedRetriever
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/rag/retriever.py", line 25, in <module>
    from src.rag.hnsw_pure import PureHNSWRetriever
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/rag/hnsw_pure.py", line 81
    def _ cosine_similarity(self, a: np.ndarray, b: np.ndarray) -> float:
          ^^^^^^^^^^^^^^^^^
SyntaxError: expected '('
WARNING:  WatchFiles detected changes in 'src/rag/hnsw_pure.py'. Reloading...
INFO:     Started server process [46100]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.218 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/ivf_pq_pure.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46100]
INFO:     Started server process [46117]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.220 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/rag/ivf_pq_pure.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46117]
INFO:     Started server process [46120]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.223 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
Starting SupplyChainRAG API...
Database tables created at sqlite:///data/supply_chain.db

Loading indices from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices...
BM25 index loaded: 190 documents from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices/bm25.pkl
All indices loaded successfully!

RAG indices loaded
INFO:     127.0.0.1:56661 - "GET /ui?mode=round&rounds=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:56661 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:56664 - "POST /chat HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'src/ui/backend_demo.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46120]
INFO:     Started server process [46436]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.219 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'src/ui/backend.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46436]
INFO:     Started server process [46448]
INFO:     Waiting for application startup.
Building prefix dict from the default dictionary ...
Loading model from cache /var/folders/2h/4q8t2r156bgchz11rxts951w0000gn/T/jieba.cache
Loading model cost 0.223 seconds.
Prefix dict has been built successfully.
INFO:     Application startup complete.
Demo router loaded at /demo/stream
Starting SupplyChainRAG API...
Database tables created at sqlite:///data/supply_chain.db

Loading indices from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices...
BM25 index loaded: 190 documents from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices/bm25.pkl
Pure HNSW index loaded: 190 vectors from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices/hnsw.npy
Pure IVF-PQ index loaded: 190 vectors from /Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/data/indices/ivf_pq.npy
All indices loaded successfully!

RAG indices loaded
INFO:     127.0.0.1:56742 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:56746 - "GET /demo/stream HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 270, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    |     result = await app(  # type: ignore[func-returns-value]
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    |     return await self.app(scope, receive, send)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 102, in app
    |     await response(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 269, in __call__
    |     with collapse_excgroups():
    |   File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    |     await func()
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 253, in stream_response
    |     async for chunk in self.body_iterator:
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend_demo.py", line 50, in demo_stream
    |     orchestrator = get_orchestrator(f"demo_{query_id}")
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 383, in get_orchestrator
    |     _orchestrators[session_id] = RoundModeOrchestrator(
    |                                  ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 279, in __init__
    |     super().__init__(session_id)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 47, in __init__
    |     self.memory_manager = MemoryManager(self.session_id)
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/memory/offload.py", line 298, in __init__
    |     self.long_term = LongTermMemory()
    |                      ^^^^^^^^^^^^^^
    | NameError: name 'LongTermMemory' is not defined
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 102, in app
    await response(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 269, in __call__
    with collapse_excgroups():
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 253, in stream_response
    async for chunk in self.body_iterator:
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend_demo.py", line 50, in demo_stream
    orchestrator = get_orchestrator(f"demo_{query_id}")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 383, in get_orchestrator
    _orchestrators[session_id] = RoundModeOrchestrator(
                                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 279, in __init__
    super().__init__(session_id)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 47, in __init__
    self.memory_manager = MemoryManager(self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/memory/offload.py", line 298, in __init__
    self.long_term = LongTermMemory()
                     ^^^^^^^^^^^^^^
NameError: name 'LongTermMemory' is not defined
INFO:     127.0.0.1:56749 - "GET /demo/stream HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 270, in __call__
  |     async with anyio.create_task_group() as task_group:
  |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    |     result = await app(  # type: ignore[func-returns-value]
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    |     return await self.app(scope, receive, send)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 102, in app
    |     await response(scope, receive, send)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 269, in __call__
    |     with collapse_excgroups():
    |   File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/contextlib.py", line 158, in __exit__
    |     self.gen.throw(typ, value, traceback)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    |     await func()
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 253, in stream_response
    |     async for chunk in self.body_iterator:
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend_demo.py", line 50, in demo_stream
    |     orchestrator = get_orchestrator(f"demo_{query_id}")
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 383, in get_orchestrator
    |     _orchestrators[session_id] = RoundModeOrchestrator(
    |                                  ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 279, in __init__
    |     super().__init__(session_id)
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 47, in __init__
    |     self.memory_manager = MemoryManager(self.session_id)
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/memory/offload.py", line 298, in __init__
    |     self.long_term = LongTermMemory()
    |                      ^^^^^^^^^^^^^^
    | NameError: name 'LongTermMemory' is not defined
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py", line 416, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/fastapi/routing.py", line 102, in app
    await response(scope, receive, send)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 269, in __call__
    with collapse_excgroups():
  File "/Users/iotrobotics/.local/share/uv/python/cpython-3.11.12-macos-aarch64-none/lib/python3.11/contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/.venv/lib/python3.11/site-packages/starlette/responses.py", line 253, in stream_response
    async for chunk in self.body_iterator:
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/ui/backend_demo.py", line 50, in demo_stream
    orchestrator = get_orchestrator(f"demo_{query_id}")
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 383, in get_orchestrator
    _orchestrators[session_id] = RoundModeOrchestrator(
                                 ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 279, in __init__
    super().__init__(session_id)
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/agent/orchestrator.py", line 47, in __init__
    self.memory_manager = MemoryManager(self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/iotrobotics/Downloads/kimitest/SupplyChainRAG/src/memory/offload.py", line 298, in __init__
    self.long_term = LongTermMemory()
                     ^^^^^^^^^^^^^^
NameError: name 'LongTermMemory' is not defined
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [46448]
INFO:     Stopping reloader process [45394]
